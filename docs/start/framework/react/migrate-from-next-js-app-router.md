---
id: migrate-from-next-js-app-router
title: Migrate from Next.js App Router
---

This guide provides a step-by-step process to migrate a project from the Next.js App Router to **TanStack Start**. We respect the powerful features of Next.js and aim to make this transition as smooth and professional as possible.

# Step-by-Step (Basics)

- ## Prerequisites

  You can clone the [Next.js App Router Starter](https://github.com/nrjdalal/awesome-templates/tree/main/next.js-apps/next.js-start) to follow along with this guide.

  ```shell
  npx gitpick nrjdalal/awesome-templates/tree/main/next.js-apps/next.js-start next.js-start-er
  ```

  This starter is a basic Next.js application using the App Router, which we will migrate to **TanStack Start**.

1. ## Remove Next.js

   First, uninstall Next.js and remove adjacent configuration files:

   ```shell
   npm uninstall next
   rm next.config.* postcss.config.*
   ```

2. ## Install Required Dependencies

   **TanStack Start** leverages Vite and TanStack Router:

   ```shell
   npm i @tanstack/react-router@alpha @tanstack/react-start@alpha vite
   ```

   For TypeScript support and Tailwind CSS:

   ```shell
   npm i -D @tailwindcss/postcss postcss tailwindcss vite-tsconfig-paths
   ```

   > Note: We use `@alpha` tags until the packages reach stability.

3. ## Update Project Configuration

- `package.json`

  ```json
  {
    "type": "module",
    "scripts": {
      "dev": "vite dev",
      "build": "vite build",
      "start": "node .output/server/index.mjs"
    }
  }
  ```

- `vite.config.ts`

  ```ts
  import { tanstackStart } from '@tanstack/react-start/plugin/vite'
  import { defineConfig } from 'vite'
  import tsConfigPaths from 'vite-tsconfig-paths'

  export default defineConfig({
    server: {
      port: 3000,
    },
    plugins: [
      tsConfigPaths(),
      tanstackStart({
        tsr: {
          // This is the directory where TanStack Router will look for your routes.
          routesDirectory: 'src/app',
        },
      }),
    ],
  })
  ```

  By default, `routesDirectory` is set to `src/routes`. If you want to maintain consistency with Next.js App Router conventions, you can set it to `src/app` instead.

- `postcss.config.ts`

  ```ts
  export default {
    plugins: {
      '@tailwindcss/postcss': {},
    },
  }
  ```

4. ## Adapt the Root Layout

   > **TanStack Start** uses routing adjacent to Next.js, but with a [different structure](https://tanstack.com/router/latest/docs/framework/react/routing/routing-concepts).

   Instead of `layout.tsx`, you will create a file named `__root.tsx` in the `src/app` directory. This file will serve as the root layout for your application.

- `src/app/layout.tsx` to `src/app/__root.tsx`

  ```diff
  - import type { Metadata } from "next"
  import {
    Outlet,
    createRootRoute,
    HeadContent,
    Scripts,
  } from "@tanstack/react-router"
  import "./globals.css"

  - export const metadata: Metadata = {
  -   title: "Create Next App",
  -   description: "Generated by create next app",
  - }
  export const Route = createRootRoute({
    head: () => ({
      meta: [
        { charSet: "utf-8" },
        {
          name: "viewport",
          content: "width=device-width, initial-scale=1",
        },
        { title: "TanStack Start Starter" }
      ],
    }),
    component: RootLayout,
  })

  - export default function RootLayout({
  -   children,
  - }: Readonly<{
  -   children: React.ReactNode
  - }>) {
  -   return (
  -     <html lang="en">
  -       <body>{children}</body>
  -     </html>
  -   )
  - }
  function RootLayout() {
    return (
      <html lang="en">
        <head>
          <HeadContent />
        </head>
        <body>
          <Outlet />
          <Scripts />
        </body>
      </html>
    )
  }
  ```

5. ## Adapt the Home Page

   > **TanStack Start** uses routing adjacent to Next.js, but with a [different structure](https://tanstack.com/router/latest/docs/framework/react/routing/routing-concepts).

   Instead of `page.tsx`, you will create an `index.tsx` file for the `/` route.

- `src/app/page.tsx` to `src/app/index.tsx`

  ```diff
  - export default function Home() {
  + export const Route = createFileRoute({
  +   component: Home,
  + })

  + function Home() {
    return (
      <main className="min-h-dvh w-screen flex items-center justify-center flex-col gap-y-4 p-4">
        <img
          className="max-w-sm w-full"
          src="https://tanstack.com/assets/splash-dark-8nwlc0Nt.png"
          alt="TanStack Logo"
        />
        <h1>
          <span className="line-through">Next.js</span> TanStack Start
        </h1>
        <a
          className="bg-foreground text-background rounded-full px-4 py-1 hover:opacity-90"
          href="https://tanstack.com/start/latest"
          target="_blank"
        >
          Docs
        </a>
      </main>
    )
  }
  ```

6. ## Are we migrated yet?

   One last thing before we can run the development server, we need to create a router file that will dictate the behavior of TanStack Router used within **TanStack Start**.

- `src/app/router.ts`

  ```tsx
  import { createRouter as createTanStackRouter } from '@tanstack/react-router'
  import { routeTree } from './routeTree.gen'

  export function createRouter() {
    const router = createTanStackRouter({
      routeTree,
      scrollRestoration: true,
    })

    return router
  }

  declare module '@tanstack/react-router' {
    interface Register {
      router: ReturnType<typeof createRouter>
    }
  }
  ```

  > Here you can configure everything from the default [preloading functionality](https://tanstack.com/router/latest/docs/framework/react/guide/preloading) to [caching staleness](https://tanstack.com/router/latest/docs/framework/react/guide/data-loading).

7. ## Verify the Migration

   Run the development server:

   ```shell
   npm run dev
   ```

   Then visit http://localhost:3000. You should see the **TanStack Start** welcome page with its logo and documentation link.

   > If you encounter issues, review the steps above and ensure file names and paths match exactly. For reference implementation, see the [after migration repository](https://github.com/nrjdalal/next-to-start).

# Next Steps (Advanced)

- ## Routing Concepts

  | Route Example               | Next.js                         | TanStack Start            |
  | --------------------------- | ------------------------------- | ------------------------- |
  | Root Layout                 | `src/app/layout.tsx`            | `src/app/__root.tsx`      |
  | `/` (Home Page)             | `src/app/page.tsx`              | `src/app/index.tsx`       |
  | `/posts` (Static Route)     | `src/app/posts/page.tsx`        | `src/app/posts.tsx`       |
  | `/posts/:slug` (Dynamic)    | `src/app/posts/[slug]/page.tsx` | `src/app/posts/$slug.tsx` |
  | `/api/endpoint` (API Route) | `src/app/api/endpoint/route.ts` | `src/app/api/endpoint.ts` |

  Learn more about the [Routing Concepts](https://tanstack.com/router/latest/docs/framework/react/routing/routing-concepts).

- ## Dynamic and Catch-All Routes

  Getting dynamic route parameters in **TanStack Start** is straightforward.

  ```diff
  - export default async function Page({
  -   params,
  - }: {
  -   params: Promise<{ slug: string }>
  - }) {
  + export const Route = createFileRoute({
  +   component: Home,
  + })

  + function Page() {
  -   const { slug } = await params
  +   const { slug } = Route.useParams()
    return <div>My Post: {slug}</div>
  }
  ```

  Similarly, you can get `searchParams` like `const { page, filter, sort } = Route.useSearch()`.

  Learn more about the [Dynamic and Catch-All Routes](https://tanstack.com/router/latest/docs/framework/react/routing/routing-concepts#dynamic-route-segments).

- ## Links

  ```diff
  - import Link from "next/link"
  + import { Link } from "@tanstack/react-router"

  function Component() {
  -   return <Link href="/dashboard">Dashboard</Link>
  +   return <Link to="/dashboard">Dashboard</Link>
  }
  ```

  Learn more about the [Links](https://tanstack.com/start/latest/docs/framework/react/learn-the-basics#navigation).

- ## Server ~Actions~ Functions

  ```diff
  - 'use server'
  + import { createServerFn } from '@tanstack/react-start'

  - export const create = async () => {
  + export const create = createServerFn().handler(async () => {
    return true
  - }
  + })
  ```

  Learn more about the [Server Functions](https://tanstack.com/start/latest/docs/framework/react/server-functions).

- ## Server Routes ~Handlers~

  ```diff
  - export async function GET() {
  + export const ServerRoute = createServerFileRoute().methods({
  +   GET: async () => {
      return Response.json("Hello, World!")
    }
  + })
  ```

  Learn more about the [Server Routes](https://tanstack.com/start/latest/docs/framework/react/server-routes).

- ## Fonts

  ```diff
  - import { Inter } from "next/font/google"

  - const inter = Inter({
  -   subsets: ["latin"],
  -   display: "swap",
  - })

  - export default function Page() {
  -   return <p className={inter.className}>Font Sans</p>
  - }
  ```

  Instead of next/font, use Tailwind CSSâ€™s CSS-first approach. Install fonts (e.g. from [Fontsource](https://github.com/fontsource/fontsource)):

  ```shell
  npm i -D @fontsource-variable/dm-sans @fontsource-variable/jetbrains-mono
  ```

  Add to `src/app/globals.css`:

  ```css
  /* src/app/globals.css */

  @import 'tailwindcss';

  @import '@fontsource-variable/dm-sans';
  @import '@fontsource-variable/jetbrains-mono';

  @theme inline {
    --font-sans: 'DM Sans Variable', sans-serif;
    --font-mono: 'JetBrains Mono Variable', monospace;
    /* ... */
  }

  /* ... */
  ```
