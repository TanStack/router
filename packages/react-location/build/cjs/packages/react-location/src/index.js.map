{"version":3,"file":"index.js","sources":["../../../../../src/index.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport {\n  createHashHistory,\n  createBrowserHistory,\n  createMemoryHistory,\n  BrowserHistory,\n  MemoryHistory,\n  History,\n  HashHistory,\n} from 'history'\n\nexport { createHashHistory, createBrowserHistory, createMemoryHistory }\n\n// Types\n\ntype Timeout = ReturnType<typeof setTimeout>\n\ntype Maybe<T, TUnknown> = T extends {} ? T : TUnknown\n\nexport type DefaultGenerics = {\n  Params: Params<string>\n  Search: Search<unknown>\n  RouteMeta: RouteMeta<unknown>\n}\n\nexport type PartialGenerics = Partial<DefaultGenerics>\nexport type MakeGenerics<TGenerics extends PartialGenerics> = TGenerics\n\nexport type Search<T> = Record<string, T>\nexport type Params<T> = Record<string, T>\nexport type RouteMeta<T> = Record<string, T>\n\nexport type UseGeneric<\n  TGenerics extends PartialGenerics,\n  TGeneric extends keyof PartialGenerics,\n> = TGeneric extends 'Search'\n  ? Partial<Maybe<TGenerics[TGeneric], DefaultGenerics[TGeneric]>>\n  : Maybe<TGenerics[TGeneric], DefaultGenerics[TGeneric]>\n\nexport type ReactLocationOptions = {\n  // The history object to be used internally by react-location\n  // A history will be created automatically if not provided.\n  history?: BrowserHistory | MemoryHistory | HashHistory\n  stringifySearch?: SearchSerializer\n  parseSearch?: SearchParser\n}\n\ntype SearchSerializer = (searchObj: Record<string, any>) => string\ntype SearchParser = (searchStr: string) => Record<string, any>\n\nexport type Updater<TResult> = TResult | ((prev?: TResult) => TResult)\n\nexport type Location<TGenerics extends PartialGenerics = DefaultGenerics> = {\n  href: string\n  pathname: string\n  search: UseGeneric<TGenerics, 'Search'>\n  searchStr: string\n  hash: string\n  key?: string\n  // nextAction?: 'push' | 'replace'\n}\n\nexport type Route<TGenerics extends PartialGenerics = DefaultGenerics> = {\n  // The path to match (relative to the nearest parent `Route` component or root basepath)\n  path?: string\n  // An ID to uniquely identify this route within its siblings. This is only required for routes that *only match on search* or if you have multiple routes with the same path\n  id?: string\n  // If true, this route will be matched as case-sensitive\n  caseSensitive?: boolean\n  // Either (1) an object that will be used to shallowly match the current location's search or (2) A function that receives the current search params and can return truthy if they are matched.\n  search?: SearchPredicate<UseGeneric<TGenerics, 'Search'>>\n  // The duration to wait during `loader` execution before showing the `pendingElement`\n  searchFilters?: SearchFilter<TGenerics>[]\n  // An array of child routes\n  children?: Route<TGenerics>[]\n  // Route Loaders (see below) can be inline on the route, or resolved async\n} & RouteLoaders<TGenerics>\n\nexport type RouteLoaders<TGenerics> = {\n  // The content to be rendered when the route is matched. If no element is provided, defaults to `<Outlet />`\n  element?: React.ReactNode\n  // An asynchronous function responsible for preparing or fetching data for the route before it is rendered\n  onMatch?: (\n    match: RouteMatch<TGenerics>,\n  ) => void | undefined | ((match: RouteMatch<TGenerics>) => void)\n  // This function is called when the route remains active from one transition to the next.\n  onTransition?: (match: RouteMatch<TGenerics>) => void\n  // An object of whatever you want! This object is accessible anywhere matches are.\n  meta?: UseGeneric<TGenerics, 'RouteMeta'>\n}\n\nexport type SearchFilter<TGenerics> = (\n  prev: UseGeneric<TGenerics, 'Search'>,\n  next: UseGeneric<TGenerics, 'Search'>,\n) => UseGeneric<TGenerics, 'Search'>\n\nexport type MatchLocation<TGenerics extends PartialGenerics = DefaultGenerics> =\n  {\n    to?: string | number | null\n    search?: SearchPredicate<UseGeneric<TGenerics, 'Search'>>\n    fuzzy?: boolean\n    caseSensitive?: boolean\n  }\n\nexport type SearchPredicate<TSearch> = (search: TSearch) => any\n\nexport type UnloadedMatch<TGenerics extends PartialGenerics = DefaultGenerics> =\n  {\n    id: string\n    route: Route<TGenerics>\n    pathname: string\n    params: UseGeneric<TGenerics, 'Params'>\n    search: UseGeneric<TGenerics, 'Search'>\n  }\n\nexport type ListenerFn = () => void\n\nexport type Segment = {\n  type: 'pathname' | 'param' | 'wildcard'\n  value: string\n}\n\nexport type RouterProps<TGenerics extends PartialGenerics = DefaultGenerics> = {\n  // Children will default to `<Outlet />` if not provided\n  children?: React.ReactNode\n  location: ReactLocation<TGenerics>\n} & RouterOptions<TGenerics>\n\nexport type RouterOptions<TGenerics> = {\n  // An array of route objects to match\n  routes: Route<TGenerics>[]\n  basepath?: string\n  filterRoutes?: FilterRoutesFn\n  useErrorBoundary?: boolean\n  defaultElement?: React.ReactNode\n  caseSensitive?: boolean\n  // An array of route match objects that have been both _matched_ and _loaded_. See the [SRR](#ssr) section for more details\n  // snapshot?: RouterSnapshot<TGenerics>\n}\n\nexport type BuildNextOptions<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = {\n  to?: string | number | null\n  search?: true | Updater<UseGeneric<TGenerics, 'Search'>>\n  hash?: Updater<string>\n  from?: Partial<Location<TGenerics>>\n  key?: string\n  __searchFilters?: SearchFilter<TGenerics>[]\n}\n\nexport type NavigateOptions<TGenerics> = BuildNextOptions<TGenerics> & {\n  replace?: boolean\n  fromCurrent?: boolean\n}\n\nexport type PromptProps = {\n  message: string\n  when?: boolean | any\n  children?: React.ReactNode\n}\n\nexport type LinkProps<TGenerics extends PartialGenerics = DefaultGenerics> =\n  Omit<React.AnchorHTMLAttributes<HTMLAnchorElement>, 'href' | 'children'> & {\n    // The absolute or relative destination pathname\n    to?: string | number | null\n    // The new search object or a function to update it\n    search?: true | Updater<UseGeneric<TGenerics, 'Search'>>\n    // The new has string or a function to update it\n    hash?: Updater<string>\n    // Whether to replace the current history stack instead of pushing a new one\n    replace?: boolean\n    // A function that is passed the [Location API](#location-api) and returns additional props for the `active` state of this link. These props override other props passed to the link (`style`'s are merged, `className`'s are concatenated)\n    getActiveProps?: () => Record<string, any>\n    // A function that is passed the [Location API](#location-api) and returns additional props for the `inactive` state of this link. These props override other props passed to the link (`style`'s are merged, `className`'s are concatenated)\n    getInactiveProps?: () => Record<string, any>\n    // Defaults to `{ exact: false, includeHash: false }`\n    activeOptions?: ActiveOptions\n    // If true, will render the link without the href attribute\n    disabled?: boolean\n    // A custom ref prop because of this: https://stackoverflow.com/questions/58469229/react-with-typescript-generics-while-using-react-forwardref/58473012\n    _ref?: React.Ref<HTMLAnchorElement>\n    // If a function is pass as a child, it will be given the `isActive` boolean to aid in further styling on the element it returns\n    children?:\n      | React.ReactNode\n      | ((state: { isActive: boolean }) => React.ReactNode)\n  }\n\ntype ActiveOptions = {\n  exact?: boolean\n  includeHash?: boolean\n}\n\nexport type LinkPropsType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  LinkProps<TGenerics>\n\nexport type TransitionState<TGenerics> = {\n  location: Location<TGenerics>\n  matches: RouteMatch<TGenerics>[]\n}\n\nexport type FilterRoutesFn = <\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(\n  routes: Route<TGenerics>[],\n) => Route<TGenerics>[]\n\nexport type RouterPropsType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = RouterProps<TGenerics>\n\nexport type RouterType<TGenerics extends PartialGenerics = DefaultGenerics> = (\n  props: RouterProps<TGenerics>,\n) => JSX.Element\n\ntype Listener = () => void\n\n// Source\n\nconst LocationContext = React.createContext<{ location: ReactLocation<any> }>(\n  null!,\n)\nconst MatchesContext = React.createContext<RouteMatch<any>[]>(null!)\nconst routerContext = React.createContext<{ router: RouterInstance<any> }>(\n  null!,\n)\n\n// Detect if we're in the DOM\nconst isDOM = Boolean(\n  typeof window !== 'undefined' &&\n    window.document &&\n    window.document.createElement,\n)\n\nconst useLayoutEffect = isDOM ? React.useLayoutEffect : React.useEffect\n\n// This is the default history object if none is defined\nconst createDefaultHistory = () =>\n  isDOM ? createBrowserHistory() : createMemoryHistory()\n\nclass Subscribable {\n  listeners: Listener[]\n\n  constructor() {\n    this.listeners = []\n  }\n\n  subscribe(listener: Listener): () => void {\n    this.listeners.push(listener as Listener)\n\n    return () => {\n      this.listeners = this.listeners.filter((x) => x !== listener)\n    }\n  }\n\n  notify(): void {\n    this.listeners.forEach((listener) => listener())\n  }\n}\n\nexport class ReactLocation<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> extends Subscribable {\n  history: BrowserHistory | MemoryHistory\n  stringifySearch: SearchSerializer\n  parseSearch: SearchParser\n\n  current: Location<TGenerics>\n  destroy: () => void\n  navigateTimeout?: Timeout\n  nextAction?: 'push' | 'replace'\n\n  //\n\n  isTransitioning: boolean = false\n\n  constructor(options?: ReactLocationOptions) {\n    super()\n    this.history = options?.history || createDefaultHistory()\n    this.stringifySearch = options?.stringifySearch ?? defaultStringifySearch\n    this.parseSearch = options?.parseSearch ?? defaultParseSearch\n\n    this.current = this.parseLocation(this.history.location)\n\n    this.destroy = this.history.listen((event) => {\n      this.current = this.parseLocation(event.location, this.current)\n      this.notify()\n    })\n  }\n\n  buildNext(\n    basepath: string = '/',\n    dest: BuildNextOptions<TGenerics> = {},\n  ): Location<TGenerics> {\n    const from = {\n      ...this.current,\n      ...dest.from,\n    }\n\n    const pathname = resolvePath(basepath, from.pathname, `${dest.to ?? '.'}`)\n\n    const updatedSearch =\n      (dest.search === true\n        ? from.search\n        : functionalUpdate(dest.search, from.search)) ?? {}\n\n    const filteredSearch = dest.__searchFilters?.length\n      ? dest.__searchFilters.reduce(\n          (prev, next) => next(prev, updatedSearch),\n          from.search,\n        )\n      : updatedSearch\n\n    const search = replaceEqualDeep(from.search, filteredSearch)\n\n    const searchStr = this.stringifySearch(search)\n    let hash = functionalUpdate(dest.hash, from.hash)\n    hash = hash ? `#${hash}` : ''\n\n    return {\n      pathname,\n      search,\n      searchStr,\n      hash,\n      href: `${pathname}${searchStr}${hash}`,\n      key: dest.key,\n    }\n  }\n\n  navigate(next: Location<TGenerics>, replace?: boolean): void {\n    this.current = next\n\n    if (this.navigateTimeout) clearTimeout(this.navigateTimeout)\n\n    let nextAction: 'push' | 'replace' = 'replace'\n\n    if (!this.nextAction) {\n      nextAction = replace ? 'replace' : 'push'\n    }\n\n    if (!replace) {\n      nextAction = 'push'\n    }\n\n    this.nextAction = nextAction\n\n    this.navigateTimeout = setTimeout(() => {\n      let nextAction = this.nextAction\n      delete this.nextAction\n\n      const isSameUrl =\n        this.parseLocation(this.history.location).href === this.current.href\n\n      if (isSameUrl && !this.current.key) {\n        nextAction = 'replace'\n      }\n\n      if (nextAction === 'replace') {\n        return this.history.replace({\n          pathname: this.current.pathname,\n          hash: this.current.hash,\n          search: this.current.searchStr,\n        })\n      }\n\n      return this.history.push({\n        pathname: this.current.pathname,\n        hash: this.current.hash,\n        search: this.current.searchStr,\n      })\n    }, 16)\n  }\n\n  parseLocation(\n    location: History['location'],\n    previousLocation?: Location<TGenerics>,\n  ): Location<TGenerics> {\n    const parsedSearch = this.parseSearch(location.search)\n\n    return {\n      pathname: location.pathname,\n      searchStr: location.search,\n      search: replaceEqualDeep(previousLocation?.search, parsedSearch),\n      hash: location.hash.split('#').reverse()[0] ?? '',\n      href: `${location.pathname}${location.search}${location.hash}`,\n      key: location.key,\n    }\n  }\n}\n\nexport type MatchesProviderProps<TGenerics> = {\n  value: RouteMatch<TGenerics>[]\n  children: React.ReactNode\n}\n\nexport function MatchesProvider<TGenerics>(\n  props: MatchesProviderProps<TGenerics>,\n) {\n  return <MatchesContext.Provider {...props} />\n}\n\nexport function Router<TGenerics extends PartialGenerics = DefaultGenerics>({\n  children,\n  location,\n  // snapshot,\n  ...rest\n}: RouterProps<TGenerics>) {\n  const routerRef = React.useRef<RouterInstance<TGenerics>>(null!)\n  if (!routerRef.current) {\n    routerRef.current = new RouterInstance<TGenerics>({\n      location,\n      // snapshot,\n      routes: rest.routes,\n    })\n  }\n  const router = routerRef.current\n\n  const [nonce, rerender] = React.useReducer(() => ({}), {})\n\n  router.update(rest)\n\n  useLayoutEffect(() => {\n    return router.subscribe(() => {\n      rerender()\n    })\n  }, [])\n\n  useLayoutEffect(() => {\n    return router.updateLocation(location.current).unsubscribe\n  }, [location.current.key])\n\n  const routerValue = React.useMemo(\n    () => ({\n      router,\n    }),\n    [nonce],\n  )\n\n  return (\n    <LocationContext.Provider value={{ location }}>\n      <routerContext.Provider value={routerValue}>\n        <MatchesProvider value={[router.rootMatch!, ...router.state.matches]}>\n          {children ?? <Outlet />}\n        </MatchesProvider>\n      </routerContext.Provider>\n    </LocationContext.Provider>\n  )\n}\n\ntype RouterInstanceState<TGenerics> = {\n  state: TransitionState<TGenerics>\n  pending?: TransitionState<TGenerics>\n}\n\nexport class RouterInstance<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> extends Subscribable {\n  basepath?: string\n  rootMatch?: RouteMatch<TGenerics>\n  state: TransitionState<TGenerics>\n  routes!: Route<TGenerics>[]\n  filterRoutes?: FilterRoutesFn\n  useErrorBoundary?: boolean\n  defaultElement: React.ReactNode\n  caseSensitive?: boolean\n\n  routesById: Record<string, Route<TGenerics>> = {}\n\n  constructor({\n    location,\n    // snapshot,\n    ...rest\n  }: {\n    location: ReactLocation<TGenerics>\n    // snapshot?: RouterSnapshot<TGenerics>\n  } & RouterOptions<TGenerics>) {\n    super()\n\n    this.update(rest)\n\n    // if (snapshot) {\n    //   const matchLoader = new MatchLoader(this, location.current)\n    //   matchLoader.matches.forEach((match, index) => {\n    //     if (match.id !== snapshot.matches[index]?.id) {\n    //       throw new Error(\n    //         `Router hydration mismatch: ${match.id} !== ${snapshot.matches[index]?.id}`,\n    //       )\n    //     }\n    //     match.ownData = snapshot.matches[index]?.ownData ?? {}\n    //   })\n    //   cascadeMatchData(matchLoader.matches)\n    // }\n\n    this.state = {\n      // location: snapshot?.location ?? location.current,\n      // matches: matchLoader.matches,\n      location: location.current,\n      matches: [],\n    }\n\n    location.subscribe(() => this.notify())\n  }\n\n  update = ({ basepath, routes, ...opts }: RouterOptions<TGenerics>) => {\n    Object.assign(this, opts)\n\n    this.basepath = cleanPath(`/${basepath ?? ''}`)\n\n    this.routesById = {}\n\n    const recurseRoutes = (\n      routes: Route<TGenerics>[],\n      parent?: Route<TGenerics>,\n    ): Route<TGenerics>[] => {\n      return routes.map((route) => {\n        const path = route.path ?? '*'\n\n        const id = joinPaths([\n          parent?.id === 'root' ? '' : parent?.id,\n          `${path?.replace(/(.)\\/$/, '$1')}${route.id ? `-${route.id}` : ''}`,\n        ])\n\n        route = {\n          ...route,\n          id,\n        }\n\n        if (this.routesById[id]) {\n          if (process.env.NODE_ENV !== 'production') {\n            console.warn(\n              `Duplicate routes found with id: ${id}`,\n              this.routesById,\n              route,\n            )\n          }\n          throw new Error()\n        }\n\n        this.routesById[id] = route\n\n        route.children = route.children?.length\n          ? recurseRoutes(route.children, route)\n          : undefined\n\n        return route\n      })\n    }\n\n    this.routes = recurseRoutes(routes)\n\n    this.rootMatch = {\n      id: 'root',\n      params: {} as any,\n      search: {} as any,\n      pathname: this.basepath,\n      route: null!,\n      isLoading: false,\n      status: 'resolved',\n    }\n  }\n\n  setState = (\n    updater: (\n      old: RouterInstanceState<TGenerics>,\n    ) => RouterInstanceState<TGenerics>,\n  ) => {\n    const newState = updater({ state: this.state, pending: this.pending })\n    this.state = newState.state\n    this.pending = newState.pending\n    this.cleanMatchCache()\n    this.notify()\n  }\n\n  updateLocation = (next: Location<TGenerics>) => {\n    let unsubscribe: () => void\n\n    const promise = new Promise<void>((resolve) => {\n      const matchLoader = new MatchLoader(this, next)\n\n      this.setState((old) => {\n        return {\n          ...old,\n          pending: {\n            location: matchLoader.location,\n            matches: matchLoader.matches,\n          },\n        }\n      })\n\n      unsubscribe = matchLoader.subscribe(() => {\n        const currentMatches = this.state.matches\n\n        currentMatches\n          .filter((d) => {\n            return !matchLoader.matches.find((dd) => dd.id === d.id)\n          })\n          .forEach((d) => {\n            d.onExit?.(d)\n          })\n\n        currentMatches\n          .filter((d) => {\n            return matchLoader.matches.find((dd) => dd.id === d.id)\n          })\n          .forEach((d) => {\n            d.route.onTransition?.(d)\n          })\n\n        matchLoader.matches\n          .filter((d) => {\n            return !currentMatches.find((dd) => dd.id === d.id)\n          })\n          .forEach((d) => {\n            d.onExit = d.route.onMatch?.(d)\n          })\n\n        this.setState((old) => {\n          return {\n            ...old,\n            state: {\n              location: matchLoader.location,\n              matches: matchLoader.matches,\n            },\n            pending: undefined,\n          }\n        })\n\n        resolve()\n      })\n\n      matchLoader.loadData()\n      matchLoader.startPending()\n    })\n\n    return {\n      promise,\n      unsubscribe: unsubscribe!,\n    }\n  }\n\n  // snapshot = (): RouterSnapshot<TGenerics> => {\n  //   return {\n  //     location: this.state.location,\n  //     matches: this.state.matches.map(({ ownData, id }) => {\n  //       return {\n  //         id,\n  //         ownData,\n  //       }\n  //     }),\n  //   }\n  // }\n}\n\nexport type UseLocationType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = () => ReactLocation<TGenerics>\n\nexport function useLocation<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): ReactLocation<TGenerics> {\n  // const getIsMounted = useGetIsMounted()\n  // const [, rerender] = React.useReducer((d) => d + 1, 0)\n  const context = React.useContext(LocationContext) as {\n    location: ReactLocation<TGenerics>\n  }\n  warning(!!context, 'useLocation must be used within a <ReactLocation />')\n\n  // useLayoutEffect(() => {\n  //   return instance.subscribe(() => {\n  //     // Rerender all subscribers in a microtask\n  //     Promise.resolve().then(() => {\n  //       // setTimeout(function renderAllLocationSubscribers() {\n  //       if (getIsMounted()) {\n  //         rerender()\n  //       }\n  //       // }, 0)\n  //     })\n  //   })\n  // }, [instance])\n\n  return context.location\n}\n\ntype RouteMatch<TGenerics extends PartialGenerics = DefaultGenerics> = {\n  id: string\n  route: Route<TGenerics>\n  pathname: string\n  params: UseGeneric<TGenerics, 'Params'>\n  search: UseGeneric<TGenerics, 'Search'>\n}\n\nclass MatchLoader<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> extends Subscribable {\n  router: RouterInstance<TGenerics>\n  location: Location<TGenerics>\n  matches: RouteMatch<TGenerics>[]\n  prepPromise?: Promise<void>\n  matchPromise?: Promise<UnloadedMatch<TGenerics>[]>\n  firstRenderPromises?: Promise<any>[]\n\n  constructor(\n    router: RouterInstance<TGenerics>,\n    nextLocation: Location<TGenerics>,\n  ) {\n    super()\n    this.router = router\n    this.location = nextLocation\n    this.matches = []\n\n    const unloadedMatches = matchRoutes(this.router, this.location)\n\n    this.matches = unloadedMatches?.map(\n      (unloadedMatch): RouteMatch<TGenerics> => {\n        if (!this.router.matchCache[unloadedMatch.id]) {\n          this.router.matchCache[unloadedMatch.id] = new RouteMatch(\n            unloadedMatch,\n          )\n        }\n\n        return this.router.matchCache[unloadedMatch.id]!\n      },\n    )\n  }\n\n  status: 'pending' | 'resolved' = 'pending'\n\n  preNotify = (isSoft?: boolean) => {\n    if (!isSoft) {\n      this.status = 'resolved'\n    }\n\n    cascadeMatchData(this.matches)\n    this.notify()\n  }\n\n  loadData = async ({ maxAge }: { maxAge?: number } = {}) => {\n    this.router.cleanMatchCache()\n\n    if (!this.matches?.length) {\n      this.preNotify()\n      return\n    }\n\n    this.firstRenderPromises = []\n\n    this.matches.forEach((match, index) => {\n      const parentMatch = this.matches?.[index - 1]\n      match.assignMatchLoader?.(this)\n      match.load?.({ maxAge, parentMatch, router: this.router })\n      this.firstRenderPromises?.push(match.loaderPromise!)\n    })\n\n    return await Promise.all(this.firstRenderPromises).then(() => {\n      this.preNotify()\n      return this.matches\n    })\n  }\n\n  load = async ({ maxAge }: { maxAge?: number } = {}) => {\n    return await this.loadData({ maxAge })\n  }\n\n  startPending = async () => {\n    this.matches.forEach((match) => match.startPending?.())\n  }\n}\n\nfunction cascadeMatchData<TGenerics>(matches?: RouteMatch<TGenerics>[]) {\n  matches?.forEach((match, index) => {\n    const parentMatch = matches?.[index - 1]\n\n    match.data = {\n      ...(parentMatch?.data ?? ({} as any)),\n      ...match.ownData,\n    }\n  })\n}\n\nexport type UseRouterType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  () => RouterInstance<TGenerics>\n\nexport function useRouter<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouterInstance<TGenerics> {\n  const value = React.useContext(routerContext)\n  if (!value) {\n    warning(true, 'You are trying to use useRouter() outside of ReactLocation!')\n    throw new Error()\n  }\n\n  return value.router as RouterInstance<TGenerics>\n}\n\nexport interface MatchRoutesOptions<TGenerics> {\n  filterRoutes?: FilterRoutesFn\n  defaultPendingMs?: number\n  defaultPendingMinMs?: number\n  defaultElement?: SyncOrAsyncElement<TGenerics>\n  defaultErrorElement?: SyncOrAsyncElement<TGenerics>\n  defaultPendingElement?: SyncOrAsyncElement<TGenerics>\n}\n\nexport type MatchRoutesType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (\n  router: RouterInstance<TGenerics>[],\n  currentLocation: Location<TGenerics>,\n) => Promise<UnloadedMatch<TGenerics>[]>\n\nexport function matchRoutes<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(\n  router: RouterInstance<TGenerics>,\n  currentLocation: Location<TGenerics>,\n): UnloadedMatch<TGenerics>[] {\n  if (!router.routes.length) {\n    return []\n  }\n\n  const matches: UnloadedMatch<TGenerics>[] = []\n\n  const recurse = async (\n    routes: Route<TGenerics>[],\n    parentMatch: UnloadedMatch<TGenerics>,\n  ): Promise<void> => {\n    let { pathname, params } = parentMatch\n    const filteredRoutes = router?.filterRoutes\n      ? router?.filterRoutes(routes)\n      : routes\n\n    const route = filteredRoutes.find((route) => {\n      const fullRoutePathName = joinPaths([pathname, route.path])\n\n      const fuzzy = !!(route.path !== '/' || route.children?.length)\n\n      const matchParams = matchRoute(currentLocation, {\n        to: fullRoutePathName,\n        search: route.search,\n        fuzzy,\n        caseSensitive: route.caseSensitive ?? router.caseSensitive,\n      })\n\n      if (matchParams) {\n        params = {\n          ...params,\n          ...matchParams,\n        }\n      }\n\n      return !!matchParams\n    })\n\n    if (!route) {\n      return\n    }\n\n    const interpolatedPath = interpolatePath(route.path, params)\n    pathname = joinPaths([pathname, interpolatedPath])\n\n    const interpolatedId = interpolatePath(route.id, params, true)\n\n    const match: UnloadedMatch<TGenerics> = {\n      id: interpolatedId,\n      route,\n      params,\n      pathname,\n      search: currentLocation.search,\n    }\n\n    matches.push(match)\n\n    if (route.children?.length) {\n      recurse(route.children, match)\n    }\n  }\n\n  recurse(router.routes, router.rootMatch!)\n\n  return matches\n}\n\nfunction interpolatePath(\n  path: string | undefined,\n  params: any,\n  leaveWildcard?: boolean,\n) {\n  const interpolatedPathSegments = parsePathname(path)\n\n  return joinPaths(\n    interpolatedPathSegments.map((segment) => {\n      if (segment.value === '*' && !leaveWildcard) {\n        return ''\n      }\n\n      if (segment.type === 'param') {\n        return params![segment.value.substring(1)] ?? ''\n      }\n\n      return segment.value\n    }),\n  )\n}\n\nexport type UseLoadRouteType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (routes?: Route<TGenerics>[]) => void\n\nexport function useLoadRoute<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const location = useLocation<TGenerics>()\n  const match = useMatch<TGenerics>()\n  const router = useRouter<TGenerics>()\n  const buildNext = useBuildNext<TGenerics>()\n\n  return useLatestCallback(\n    async (\n      navigate: NavigateOptions<TGenerics> = location.current,\n      opts?: { maxAge?: number },\n    ) => {\n      const next = buildNext({\n        ...navigate,\n        from: navigate.from ?? { pathname: match.pathname },\n      })\n\n      const matchLoader = new MatchLoader(router, next)\n\n      return await matchLoader.load(opts)\n    },\n  )\n}\n\nexport type UseMatchesType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = () => RouteMatch<TGenerics>[]\n\nexport function useParentMatches<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouteMatch<TGenerics>[] {\n  const router = useRouter<TGenerics>()\n  const match = useMatch()\n\n  const matches = router.state.matches\n\n  return matches.slice(0, matches.findIndex((d) => d.id === match.id) - 1)\n}\n\nexport function useMatches<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouteMatch<TGenerics>[] {\n  return React.useContext(MatchesContext)\n}\n\nexport type UseMatchType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  () => RouteMatch<TGenerics>\n\nexport function useMatch<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): RouteMatch<TGenerics> {\n  return useMatches<TGenerics>()?.[0]!\n}\n\nexport type UseNavigateType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (options: NavigateOptions<TGenerics>) => void\n\nexport function useNavigate<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const location = useLocation<TGenerics>()\n  const match = useMatch<TGenerics>()\n  const buildNext = useBuildNext<TGenerics>()\n\n  function navigate({\n    search,\n    hash,\n    replace,\n    from,\n    to,\n    fromCurrent,\n  }: NavigateOptions<TGenerics> & {\n    replace?: boolean\n  }) {\n    fromCurrent = fromCurrent ?? typeof to === 'undefined'\n\n    const next = buildNext({\n      to,\n      search,\n      hash,\n      from: fromCurrent\n        ? location.current\n        : from ?? { pathname: match.pathname },\n    })\n\n    location.navigate(next, replace)\n  }\n\n  return useLatestCallback(navigate)\n}\n\nexport type NavigateType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  (options: NavigateOptions<TGenerics>) => null\n\nexport function Navigate<TGenerics extends PartialGenerics = DefaultGenerics>(\n  options: NavigateOptions<TGenerics>,\n) {\n  let navigate = useNavigate<TGenerics>()\n\n  useLayoutEffect(() => {\n    navigate(options)\n  }, [navigate])\n\n  return null\n}\n\nfunction useBuildNext<TGenerics>() {\n  const location = useLocation<TGenerics>()\n  const router = useRouter<TGenerics>()\n\n  const buildNext = (opts: BuildNextOptions<TGenerics>) => {\n    const next = location.buildNext(router.basepath, opts)\n\n    const matches = matchRoutes<TGenerics>(router, next)\n\n    const __searchFilters = matches\n      .map((match) => match.route.searchFilters ?? [])\n      .flat()\n      .filter(Boolean)\n\n    return location.buildNext(router.basepath, { ...opts, __searchFilters })\n  }\n\n  return useLatestCallback(buildNext)\n}\n\nexport type LinkType<TGenerics extends PartialGenerics = DefaultGenerics> = (\n  props: LinkProps<TGenerics>,\n) => JSX.Element\n\nexport const Link = function Link<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>({\n  to = '.',\n  search,\n  hash,\n  children,\n  target,\n  style = {},\n  replace,\n  onClick,\n  onMouseEnter,\n  className = '',\n  getActiveProps = () => ({}),\n  getInactiveProps = () => ({}),\n  activeOptions,\n  preload,\n  disabled,\n  _ref,\n  ...rest\n}: LinkProps<TGenerics>) {\n  const loadRoute = useLoadRoute<TGenerics>()\n  const match = useMatch<TGenerics>()\n  const location = useLocation<TGenerics>()\n  const router = useRouter<TGenerics>()\n  const navigate = useNavigate<TGenerics>()\n  const buildNext = useBuildNext<TGenerics>()\n\n  preload = preload ?? router.defaultLinkPreloadMaxAge\n\n  // If this `to` is a valid external URL, log a warning\n  try {\n    const url = new URL(`${to}`)\n    warning(\n      false,\n      `<Link /> should not be used for external URLs like: ${url.href}`,\n    )\n  } catch (e) {}\n\n  const next = buildNext({\n    to,\n    search,\n    hash,\n    from: { pathname: match.pathname },\n  })\n\n  // The click handler\n  const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {\n    if (onClick) onClick(e)\n\n    if (\n      !isCtrlEvent(e) &&\n      !e.defaultPrevented &&\n      (!target || target === '_self') &&\n      e.button === 0\n    ) {\n      e.preventDefault()\n      // All is well? Navigate!\n      navigate({\n        to,\n        search,\n        hash,\n        replace,\n        from: { pathname: match.pathname },\n      })\n    }\n  }\n\n  // The click handler\n  const handleMouseEnter = (e: React.MouseEvent<HTMLAnchorElement>) => {\n    if (onMouseEnter) onMouseEnter(e)\n\n    if (preload && preload > 0) {\n      loadRoute(\n        {\n          to,\n          search,\n          hash,\n        },\n        { maxAge: preload },\n      )\n    }\n  }\n\n  // Compare path/hash for matches\n  const pathIsEqual = location.current.pathname === next.pathname\n  const currentPathSplit = location.current.pathname.split('/')\n  const nextPathSplit = next.pathname.split('/')\n  const pathIsFuzzyEqual = nextPathSplit.every(\n    (d, i) => d === currentPathSplit[i],\n  )\n  const hashIsEqual = location.current.hash === next.hash\n\n  // Combine the matches based on user options\n  const pathTest = activeOptions?.exact ? pathIsEqual : pathIsFuzzyEqual\n  const hashTest = activeOptions?.includeHash ? hashIsEqual : true\n\n  // The final \"active\" test\n  const isActive = pathTest && hashTest\n\n  // Get the active props\n  const {\n    style: activeStyle = {},\n    className: activeClassName = '',\n    ...activeRest\n  } = isActive ? getActiveProps() : {}\n\n  // Get the inactive props\n  const {\n    style: inactiveStyle = {},\n    className: inactiveClassName = '',\n    ...inactiveRest\n  } = isActive ? {} : getInactiveProps()\n\n  return (\n    <a\n      {...{\n        ref: _ref,\n        href: disabled ? undefined : next.href,\n        onClick: handleClick,\n        onMouseEnter: handleMouseEnter,\n        target,\n        style: {\n          ...style,\n          ...activeStyle,\n          ...inactiveStyle,\n        },\n        className:\n          [className, activeClassName, inactiveClassName]\n            .filter(Boolean)\n            .join(' ') || undefined,\n        ...(disabled\n          ? {\n              role: 'link',\n              'aria-disabled': true,\n            }\n          : undefined),\n        ...rest,\n        ...activeRest,\n        ...inactiveRest,\n        children:\n          typeof children === 'function' ? children({ isActive }) : children,\n      }}\n    />\n  )\n}\n\nexport function Outlet<TGenerics extends PartialGenerics = DefaultGenerics>() {\n  const router = useRouter<TGenerics>()\n  const [_, ...matches] = useMatches<TGenerics>()\n\n  const match = matches[0]\n\n  if (!match) {\n    return null\n  }\n\n  const errorElement = match.errorElement ?? router.defaultErrorElement\n\n  const element = (() => {\n    if (match.status === 'rejected') {\n      if (errorElement) {\n        return errorElement\n      }\n\n      if (!router.useErrorBoundary) {\n        if (process.env.NODE_ENV !== 'production') {\n          const preStyle: React.HTMLAttributes<HTMLPreElement>['style'] = {\n            whiteSpace: 'normal',\n            display: 'inline-block',\n            background: 'rgba(0,0,0,.1)',\n            padding: '.1rem .2rem',\n            margin: '.1rem',\n            lineHeight: '1',\n            borderRadius: '.25rem',\n          }\n\n          return (\n            <div style={{ lineHeight: '1.7' }}>\n              <strong>\n                The following error occured in the loader for you route at:{' '}\n                <pre style={preStyle}>{match.pathname}</pre>\n              </strong>\n              .\n              <br />\n              <pre\n                style={{\n                  ...preStyle,\n                  display: 'block',\n                  padding: '.5rem',\n                  borderRadius: '.5rem',\n                }}\n              >\n                {(match.error as any).toString()}\n              </pre>\n              <br />\n              Your users won't see this message in production, but they will see{' '}\n              <strong>\"An unknown error occured!\"</strong>, which is at least\n              better than breaking your entire app. ðŸ˜Š For a better UX, please\n              specify an <pre style={preStyle}>errorElement</pre> for all of\n              your routes that contain asynchronous behavior, or at least\n              provide your own\n              <pre style={preStyle}>ErrorBoundary</pre> wrapper around your\n              renders to both the elements rendered by{' '}\n              <pre style={preStyle}>\n                {'useRoutes(routes, { useErrorBoundary: true })'}\n              </pre>{' '}\n              and <pre style={preStyle}>{'<Router useErrorBoundary />'}</pre>.{' '}\n              <br />\n              <br />\n            </div>\n          )\n        }\n        return 'An unknown error occured!'\n      }\n\n      throw match.error\n    }\n\n    const pendingElement = match.pendingElement ?? router.defaultPendingElement\n\n    if (match.status === 'loading') {\n      return null\n    }\n\n    if (match.status === 'pending') {\n      if (match.route.pendingMs || pendingElement) {\n        return pendingElement ?? null\n      }\n    }\n\n    const matchElement = match.element ?? router.defaultElement\n\n    return matchElement ?? <Outlet />\n  })()\n\n  return <MatchesProvider value={matches}>{element}</MatchesProvider>\n}\n\nexport function useResolvePath<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const router = useRouter<TGenerics>()\n  const match = useMatch<TGenerics>()\n\n  return useLatestCallback((path: string) =>\n    resolvePath(router.basepath!, match.pathname!, cleanPath(path)),\n  )\n}\n\nexport type UseSearchType<TGenerics extends PartialGenerics = DefaultGenerics> =\n  () => Partial<Maybe<TGenerics['Search'], Search<any>>>\n\nexport function useSearch<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>() {\n  const location = useLocation<TGenerics>()\n  return location.current.search\n}\n\nexport type MatchRouteType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = (\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n) => UseGeneric<TGenerics, 'Params'> | undefined\n\nexport function matchRoute<TGenerics extends PartialGenerics = DefaultGenerics>(\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n): UseGeneric<TGenerics, 'Params'> | undefined {\n  const pathParams = matchByPath(currentLocation, matchLocation)\n  const searchMatched = matchBySearch(currentLocation, matchLocation)\n\n  if (matchLocation.to && !pathParams) {\n    return\n  }\n\n  if (matchLocation.search && !searchMatched) {\n    return\n  }\n\n  return (pathParams ?? {}) as UseGeneric<TGenerics, 'Params'>\n}\n\nexport type UseMatchRouteType<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n> = () => (\n  matchLocation: MatchLocation<TGenerics>,\n) => Maybe<TGenerics['Params'], Params<any>> | undefined\n\nexport type UseMatchRouteOptions<TGenerics> = MatchLocation<TGenerics> & {\n  pending?: boolean\n}\n\nexport function useMatchRoute<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(): (\n  matchLocation: UseMatchRouteOptions<TGenerics>,\n  opts?: { caseSensitive?: boolean },\n) => Maybe<TGenerics['Params'], Params<any>> | undefined {\n  const router = useRouter<TGenerics>()\n  const resolvePath = useResolvePath<TGenerics>()\n\n  return useLatestCallback(\n    ({\n      pending,\n      ...matchLocation\n    }: MatchLocation<TGenerics> & { pending?: boolean }) => {\n      matchLocation = {\n        ...matchLocation,\n        to: matchLocation.to ? resolvePath(`${matchLocation.to}`) : undefined,\n      }\n\n      if (pending) {\n        if (!router.pending?.location) {\n          return undefined\n        }\n        return matchRoute(router.pending.location, matchLocation)\n      }\n\n      return matchRoute(router.state.location, matchLocation)\n    },\n  )\n}\n\nexport function MatchRoute<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>({\n  children,\n  ...rest\n}: UseMatchRouteOptions<TGenerics> & {\n  children:\n    | React.ReactNode\n    | ((isNextLocation?: Params<TGenerics>) => React.ReactNode)\n}) {\n  const matchRoute = useMatchRoute<TGenerics>()\n  const match = matchRoute(rest)\n\n  if (typeof children === 'function') {\n    return children(match as any)\n  }\n\n  return match ? children : null\n}\n\nexport function usePrompt(message: string, when: boolean | any): void {\n  const location = useLocation()\n\n  React.useEffect(() => {\n    if (!when) return\n\n    let unblock = location.history.block((transition) => {\n      if (window.confirm(message)) {\n        unblock()\n        transition.retry()\n      } else {\n        location.current.pathname = window.location.pathname\n      }\n    })\n\n    return unblock\n  }, [when, location, message])\n}\n\nexport function Prompt({ message, when, children }: PromptProps) {\n  usePrompt(message, when ?? true)\n  return (children ?? null) as React.ReactNode\n}\n\nfunction warning(cond: boolean, message: string) {\n  if (!cond) {\n    if (typeof console !== 'undefined') console.warn(message)\n\n    try {\n      throw new Error(message)\n    } catch {}\n  }\n}\n\nfunction isFunction(d: any): d is Function {\n  return typeof d === 'function'\n}\n\nexport function functionalUpdate<TResult>(\n  updater?: Updater<TResult>,\n  previous?: TResult,\n) {\n  if (isFunction(updater)) {\n    return updater(previous as TResult)\n  }\n\n  return updater\n}\n\nfunction joinPaths(paths: (string | undefined)[]) {\n  return cleanPath(paths.filter(Boolean).join('/'))\n}\n\nexport function cleanPath(path: string) {\n  // remove double slashes\n  return `${path}`.replace(/\\/{2,}/g, '/')\n}\n\nexport function matchByPath<\n  TGenerics extends PartialGenerics = DefaultGenerics,\n>(\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n): UseGeneric<TGenerics, 'Params'> | undefined {\n  const baseSegments = parsePathname(currentLocation.pathname)\n  const routeSegments = parsePathname(`${matchLocation.to ?? '*'}`)\n\n  const params: Record<string, string> = {}\n\n  let isMatch = (() => {\n    for (\n      let i = 0;\n      i < Math.max(baseSegments.length, routeSegments.length);\n      i++\n    ) {\n      const baseSegment = baseSegments[i]\n      const routeSegment = routeSegments[i]\n\n      const isLastRouteSegment = i === routeSegments.length - 1\n      const isLastBaseSegment = i === baseSegments.length - 1\n\n      if (routeSegment) {\n        if (routeSegment.type === 'wildcard') {\n          if (baseSegment?.value) {\n            params['*'] = joinPaths(baseSegments.slice(i).map((d) => d.value))\n            return true\n          }\n          return false\n        }\n\n        if (routeSegment.type === 'pathname') {\n          if (routeSegment.value === '/' && !baseSegment?.value) {\n            return true\n          }\n\n          if (baseSegment) {\n            if (matchLocation.caseSensitive) {\n              if (routeSegment.value !== baseSegment.value) {\n                return false\n              }\n            } else if (\n              routeSegment.value.toLowerCase() !==\n              baseSegment.value.toLowerCase()\n            ) {\n              return false\n            }\n          }\n        }\n\n        if (!baseSegment) {\n          return false\n        }\n\n        if (routeSegment.type === 'param') {\n          params[routeSegment.value.substring(1)] = baseSegment.value\n        }\n      }\n\n      if (isLastRouteSegment && !isLastBaseSegment) {\n        return !!matchLocation.fuzzy\n      }\n    }\n    return true\n  })()\n\n  return isMatch ? (params as UseGeneric<TGenerics, 'Params'>) : undefined\n}\n\nfunction matchBySearch<TGenerics extends PartialGenerics = DefaultGenerics>(\n  currentLocation: Location<TGenerics>,\n  matchLocation: MatchLocation<TGenerics>,\n) {\n  return !!(\n    matchLocation.search && matchLocation.search(currentLocation.search)\n  )\n}\n\nexport function parsePathname(pathname?: string): Segment[] {\n  if (!pathname) {\n    return []\n  }\n\n  pathname = cleanPath(pathname)\n\n  const segments: Segment[] = []\n\n  if (pathname.slice(0, 1) === '/') {\n    pathname = pathname.substring(1)\n    segments.push({\n      type: 'pathname',\n      value: '/',\n    })\n  }\n\n  if (!pathname) {\n    return segments\n  }\n\n  // Remove empty segments and '.' segments\n  const split = pathname.split('/').filter(Boolean)\n\n  segments.push(\n    ...split.map((part): Segment => {\n      if (part.startsWith('*')) {\n        return {\n          type: 'wildcard',\n          value: part,\n        }\n      }\n\n      if (part.charAt(0) === ':') {\n        return {\n          type: 'param',\n          value: part,\n        }\n      }\n\n      return {\n        type: 'pathname',\n        value: part,\n      }\n    }),\n  )\n\n  if (pathname.slice(-1) === '/') {\n    pathname = pathname.substring(1)\n    segments.push({\n      type: 'pathname',\n      value: '/',\n    })\n  }\n\n  return segments\n}\n\nexport function resolvePath(basepath: string, base: string, to: string) {\n  base = base.replace(new RegExp(`^${basepath}`), '/')\n  to = to.replace(new RegExp(`^${basepath}`), '/')\n\n  let baseSegments = parsePathname(base)\n  const toSegments = parsePathname(to)\n\n  toSegments.forEach((toSegment, index) => {\n    if (toSegment.value === '/') {\n      if (!index) {\n        // Leading slash\n        baseSegments = [toSegment]\n      } else if (index === toSegments.length - 1) {\n        // Trailing Slash\n        baseSegments.push(toSegment)\n      } else {\n        // ignore inter-slashes\n      }\n    } else if (toSegment.value === '..') {\n      baseSegments.pop()\n    } else if (toSegment.value === '.') {\n      return\n    } else {\n      baseSegments.push(toSegment)\n    }\n  })\n\n  const joined = joinPaths([basepath, ...baseSegments.map((d) => d.value)])\n\n  return cleanPath(joined)\n}\n\nfunction isCtrlEvent(e: React.MouseEvent) {\n  return !!(e.metaKey || e.altKey || e.ctrlKey || e.shiftKey)\n}\n\nfunction useLatestCallback<TCallback extends (...args: any[]) => any>(\n  cb: TCallback,\n) {\n  const stableFnRef =\n    React.useRef<(...args: Parameters<TCallback>) => ReturnType<TCallback>>()\n  const cbRef = React.useRef<TCallback>(cb)\n\n  cbRef.current = cb\n\n  if (!stableFnRef.current) {\n    stableFnRef.current = (...args) => cbRef.current(...args)\n  }\n\n  return stableFnRef.current\n}\n\nfunction useGetIsMounted() {\n  const ref = React.useRef(false)\n\n  React.useEffect(() => {\n    ref.current = true\n\n    return () => {\n      ref.current = false\n    }\n  })\n\n  return () => ref.current\n}\n\n/**\n * This function returns `a` if `b` is deeply equal.\n * If not, it will replace any deeply equal children of `b` with those of `a`.\n * This can be used for structural sharing between JSON values for example.\n */\nfunction replaceEqualDeep(prev: any, next: any) {\n  if (prev === next) {\n    return prev\n  }\n\n  const array = Array.isArray(prev) && Array.isArray(next)\n\n  if (array || (isPlainObject(prev) && isPlainObject(next))) {\n    const aSize = array ? prev.length : Object.keys(prev).length\n    const bItems = array ? next : Object.keys(next)\n    const bSize = bItems.length\n    const copy: any = array ? [] : {}\n\n    let equalItems = 0\n\n    for (let i = 0; i < bSize; i++) {\n      const key = array ? i : bItems[i]\n      copy[key] = replaceEqualDeep(prev[key], next[key])\n      if (copy[key] === prev[key]) {\n        equalItems++\n      }\n    }\n\n    return aSize === bSize && equalItems === aSize ? prev : copy\n  }\n\n  return next\n}\n\n// Copied from: https://github.com/jonschlinkert/is-plain-object\nfunction isPlainObject(o: any) {\n  if (!hasObjectPrototype(o)) {\n    return false\n  }\n\n  // If has modified constructor\n  const ctor = o.constructor\n  if (typeof ctor === 'undefined') {\n    return true\n  }\n\n  // If has modified prototype\n  const prot = ctor.prototype\n  if (!hasObjectPrototype(prot)) {\n    return false\n  }\n\n  // If constructor does not have an Object-specific method\n  if (!prot.hasOwnProperty('isPrototypeOf')) {\n    return false\n  }\n\n  // Most likely a plain Object\n  return true\n}\n\nfunction hasObjectPrototype(o: any) {\n  return Object.prototype.toString.call(o) === '[object Object]'\n}\n\nexport function defaultStringifySearch(search: Record<string, unknown>) {\n  search = { ...search }\n\n  if (search) {\n    Object.keys(search).forEach((key) => {\n      const val = search[key]\n      if (typeof val === 'undefined' || val === undefined) {\n        delete search[key]\n      } else if (val && typeof val === 'object' && val !== null) {\n        try {\n          search[key] = JSON.stringify(val)\n        } catch (err) {\n          // silent\n        }\n      }\n    })\n  }\n\n  const searchStr = new URLSearchParams(\n    search as Record<string, string>,\n  ).toString()\n\n  return searchStr ? `?${searchStr}` : ''\n}\n\nexport function defaultParseSearch(searchStr: string): Record<string, any> {\n  if (searchStr.substring(0, 1) === '?') {\n    searchStr = searchStr.substring(1)\n  }\n\n  let query: Record<string, unknown> = Object.fromEntries(\n    (new URLSearchParams(searchStr) as any).entries(),\n  )\n\n  // Try to parse query params\n  for (let key in query) {\n    const value = query[key]\n\n    try {\n      query[key] = JSON.parse(value as string)\n    } catch (err) {\n      //\n    }\n  }\n\n  return query\n}\n"],"names":["_await","value","then","direct","Promise","resolve","f","args","i","arguments","length","apply","e","reject","LocationContext","React","createContext","MatchesContext","routerContext","isDOM","Boolean","window","document","createElement","useLayoutEffect","useEffect","createDefaultHistory","createBrowserHistory","createMemoryHistory","Subscribable","listeners","subscribe","listener","push","filter","x","notify","forEach","ReactLocation","options","isTransitioning","history","stringifySearch","defaultStringifySearch","parseSearch","defaultParseSearch","current","parseLocation","location","destroy","listen","event","buildNext","basepath","dest","from","pathname","resolvePath","to","updatedSearch","search","functionalUpdate","filteredSearch","__searchFilters","reduce","prev","next","replaceEqualDeep","searchStr","hash","href","key","navigate","replace","navigateTimeout","clearTimeout","nextAction","setTimeout","isSameUrl","previousLocation","parsedSearch","split","reverse","MatchesProvider","props","Router","children","rest","routerRef","useRef","RouterInstance","routes","router","useReducer","nonce","rerender","update","updateLocation","unsubscribe","routerValue","useMemo","rootMatch","state","matches","routesById","opts","Object","assign","cleanPath","recurseRoutes","parent","map","route","path","id","joinPaths","process","env","NODE_ENV","console","warn","Error","undefined","params","isLoading","status","setState","updater","newState","pending","cleanMatchCache","promise","matchLoader","MatchLoader","old","currentMatches","d","find","dd","onExit","onTransition","onMatch","loadData","startPending","useLocation","context","useContext","warning","nextLocation","preNotify","isSoft","cascadeMatchData","maxAge","firstRenderPromises","match","index","parentMatch","assignMatchLoader","load","loaderPromise","all","unloadedMatches","matchRoutes","unloadedMatch","matchCache","RouteMatch","data","ownData","useRouter","currentLocation","recurse","filteredRoutes","filterRoutes","fullRoutePathName","fuzzy","matchParams","matchRoute","caseSensitive","interpolatedPath","interpolatePath","interpolatedId","leaveWildcard","interpolatedPathSegments","parsePathname","segment","type","substring","useLoadRoute","useMatch","useBuildNext","useLatestCallback","useParentMatches","slice","findIndex","useMatches","useNavigate","fromCurrent","Navigate","searchFilters","flat","Link","target","style","onClick","onMouseEnter","className","getActiveProps","getInactiveProps","activeOptions","preload","disabled","_ref","loadRoute","defaultLinkPreloadMaxAge","url","URL","handleClick","isCtrlEvent","defaultPrevented","button","preventDefault","handleMouseEnter","pathIsEqual","currentPathSplit","nextPathSplit","pathIsFuzzyEqual","every","hashIsEqual","pathTest","exact","hashTest","includeHash","isActive","activeStyle","activeClassName","activeRest","inactiveStyle","inactiveClassName","inactiveRest","ref","join","role","Outlet","errorElement","defaultErrorElement","element","useErrorBoundary","preStyle","whiteSpace","display","background","padding","margin","lineHeight","borderRadius","error","toString","pendingElement","defaultPendingElement","pendingMs","matchElement","defaultElement","useResolvePath","useSearch","matchLocation","pathParams","matchByPath","searchMatched","matchBySearch","useMatchRoute","MatchRoute","usePrompt","message","when","unblock","block","transition","confirm","retry","Prompt","cond","isFunction","previous","paths","baseSegments","routeSegments","isMatch","Math","max","baseSegment","routeSegment","isLastRouteSegment","isLastBaseSegment","toLowerCase","segments","part","startsWith","charAt","base","RegExp","toSegments","toSegment","pop","joined","metaKey","altKey","ctrlKey","shiftKey","cb","stableFnRef","cbRef","array","Array","isArray","isPlainObject","aSize","keys","bItems","bSize","copy","equalItems","o","hasObjectPrototype","ctor","constructor","prot","prototype","hasOwnProperty","call","val","JSON","stringify","err","URLSearchParams","query","fromEntries","entries","parse"],"mappings":"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"}